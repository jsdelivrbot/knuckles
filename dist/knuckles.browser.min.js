!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Knuckles=e()}}(function(){return function e(t,n,r){function u(i,c){if(!n[i]){if(!t[i]){var a="function"==typeof require&&require;if(!c&&a)return a(i,!0);if(o)return o(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[i]={exports:{}};t[i][0].call(f.exports,function(e){var n=t[i][1][e];return u(n?n:e)},f,f.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)u(r[i]);return u}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;c=l=a=void 0,r=!1,null===u&&(u=Function.prototype);var c=Object.getOwnPropertyDescriptor(u,o);if(void 0!==c){if("value"in c)return c.value;var a=c.get;return void 0===a?void 0:a.call(i)}var l=Object.getPrototypeOf(u);if(null===l)return void 0;e=l,t=o,n=i,r=!0}},c=e("../node_modules/sonic/dist/observable_list"),a=e("../node_modules/sonic/dist/mutable_list"),l=e("./xhr"),f=function(e){function t(e){var n=this;r(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this._byKey=Object.create(null),this._prev=Object.create(null),this._next=Object.create(null),this.get=function(e){return n._byKey[e]?Promise.resolve(n._byKey[e]):l.XHR.get(n._urlRoot+"/"+e).then(function(e){return e.responseText}).then(JSON.parse).then(function(e){return n._byKey[e.id]=e})},this.prev=function(e){return n._prev[e]?Promise.resolve(n._prev[e]):n._fetch().then(function(){return n._prev[e]})},this.next=function(e){return n._next[e]?Promise.resolve(n._next[e]):n._fetch().then(function(){return n._next[e]})},this.set=function(e,t){return l.XHR.put(n._urlRoot+"/"+e,t).then(function(e){return e.responseText}).then(JSON.parse).then(function(e){return n._subject.onInvalidate(e.id)})},this.splice=function(e,t){for(var r=arguments.length,u=Array(r>2?r-2:0),o=2;r>o;o++)u[o-2]=arguments[o];return Promise.all(u.map(function(e){return l.XHR.post(n._urlRoot,e)})).then(function(r){u=r.map(function(e){return JSON.parse(e.responseText)}),u.forEach(function(t){var r=t.id;n._byKey[r]=t,n._next[e]=r,n._prev[r]=e,e=r}),n._next[e]=u[0].id,n._prev[t]=u[u.length-1].id,n._subject.onInvalidate([e,t])})},this.observe=function(e){return n._subject.observe(e)},this._subject=new c.ListSubject,this._urlRoot=e}return u(t,e),o(t,[{key:"_fetch",value:function(){var e=this;return l.XHR.get(this._urlRoot).then(function(e){return e.responseText}).then(JSON.parse).then(function(t){var n=null;t.forEach(function(t){var r=t.id;e._byKey[r]=t,e._next[n]=r,e._prev[r]=n,n=r}),e._next[n]=null,e._prev["null"]=n})}}]),t}(a.MutableList);n.Collection=f,n["default"]=f},{"../node_modules/sonic/dist/mutable_list":9,"../node_modules/sonic/dist/observable_list":13,"./xhr":3}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./xhr"),i=r(o),c=e("./collection"),a=r(c);!function(e){e.XHR=i["default"],e.Collection=a["default"]}(u||(u={})),n["default"]=u,t.exports=u,t.exports=n["default"]},{"./collection":1,"./xhr":3}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={create:function(e,t){return new Promise(function(n,r){var u=new XMLHttpRequest,o=e.toString(),i=t.method,c=t.body;u.onload=function(){u.status>=200&&u.status<400?n(u):r(u)},u.onerror=function(){r(u)},u.open(i,o,!0),u.setRequestHeader("Content-Type","application/json"),u.send(JSON.stringify(c))})},get:function(e){return r.create(e,{method:"GET"})},put:function(e,t){return r.create(e,{method:"PUT",body:t})},post:function(e,t){return r.create(e,{method:"POST",body:t})},"delete":function(e){return r.create(e,{method:"DELETE"})}};n.XHR=r,n["default"]=r},{}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var u=function o(e){var t=this;r(this,o),this.get=function(e){return e in t._byKey?Promise.resolve(t._byKey[e]):t._list.get(e).then(function(n){return t._byKey[e]=n})},this.prev=function(e){return e in t._prev?Promise.resolve(t._prev[e]):t._list.prev(e).then(function(n){return t._prev[e]=n,t._next[n]=e,n})},this.next=function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return e in t._next?Promise.resolve(t._next[e]):t._list.next(e).then(function(n){return t._next[e]=n,t._prev[n]=e,n})},this._byKey=Object.create(null),this._next=Object.create(null),this._prev=Object.create(null),this._list=e};n.Cache=u,n["default"]=u},{}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var u=e("./list"),o=function i(e){var t=this;r(this,i),this._add=function(e,n){t._byIndex[n]=e},this.get=function(e){return e>=0&&e<t._byIndex.length?t._list.get(t._byIndex[e]):u.List.find(t,function(t,n){return n===e},t._byIndex.length-1)},this.prev=function(e){return null!=e&&e>=0&&e<t._byIndex.length?Promise.resolve(0>e-1?null:e-1):u.List.some(t,function(t,n){return n===e-1},t._byIndex.length-1).then(function(n){if(n)return e-1;if(null==e)return t._byIndex.length-1;throw new Error})},this.next=function(e){var n=null==e?0:e+1;return n<t._byIndex.length?Promise.resolve(n):u.List.some(t._list,function(e,r){return t._add(r,t._byIndex.length),n===t._byIndex.length-1},t._byIndex[t._byIndex.length-1]).then(function(e){if(e)return n;if(n===t._byIndex.length)return null;throw new Error})},this._byIndex=[],this._list=e};n.Index=o,n["default"]=o},{"./list":7}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){function t(e){return e.toString()}function n(){return r++}var r=0;e.key=t,e.create=n}(r||(r={})),n["default"]=r,t.exports=n["default"]},{}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./range"),c=r(i),a=e("./tree"),l=e("./cache"),f=r(l),s=e("./index"),v=r(s),h=function(){function e(t){var n=this;u(this,e),this.get=function(e){throw new Error("Not implemented")},this.prev=function(e){throw new Error("Not implemented")},this.next=function(e){throw new Error("Not implemented")},this.first=function(){return e.first(n)},this.last=function(){return e.last(n)},this.every=function(t){return e.every(n,t)},this.some=function(t){return e.some(n,t)},this.forEach=function(t,r){return e.forEach(n,t,r)},this.reduce=function(t,r,u){return e.reduce(n,t,r,u)},this.toArray=function(t){return e.toArray(n,t)},this.findKey=function(t,r){return e.findKey(n,t,r)},this.find=function(t,r){return e.find(n,t,r)},this.keyOf=function(t,r){return e.keyOf(n,t,r)},this.indexOf=function(t,r){return e.indexOf(n,t,r)},this.keyAt=function(t,r){return e.keyAt(n,t,r)},this.at=function(t,r){return e.at(n,t,r)},this.contains=function(t,r){return e.contains(n,t,r)},this.reverse=function(){return e.create(e.reverse(n))},this.map=function(t){return e.create(e.map(n,t))},this.filter=function(t){return e.create(e.filter(n,t))},this.flatten=function(){return e.create(e.flatten(n))},this.flatMap=function(t){return e.create(e.flatMap(n,t))},this.cache=function(){return e.create(e.cache(n))},this.group=function(t){return e.create(e.group(n,t)).map(e.create).cache()},this.index=function(){return e.create(e.index(n))},this.zip=function(t,r){return e.create(e.zip(n,t,r))},this.skip=function(t){return e.create(e.skip(n,t))},this.take=function(t){return e.create(e.take(n,t))},this.range=function(t,r){return e.create(e.range(n,t,r))},this.scan=function(t,r){return e.create(e.scan(n,t,r))},null!=t&&(this.get=t.get,this.prev=t.prev,this.next=t.next)}return o(e,null,[{key:"isList",value:function(e){return null!=e&&!!e.get&&!!e.prev&&!!e.next}},{key:"create",value:function(t){return new e({get:t.get,prev:t.prev,next:t.next})}},{key:"first",value:function(e){return e.next().then(e.get)}},{key:"last",value:function(e){return e.prev().then(e.get)}},{key:"every",value:function(e,t,n){return c["default"].last(e,n).then(function(r){var u=function o(n){return null==n?Promise.resolve(!0):e.get(n).then(function(e){return t(e,n)}).then(function(t){return t===!1?!1:n==r?!0:e.next(n).then(o)})};return c["default"].first(e,n).then(u)})}},{key:"some",value:function(e,t,n){return c["default"].last(e,n).then(function(r){var u=function o(n){return null==n?Promise.resolve(!1):e.get(n).then(function(e){return t(e,n)}).then(function(t){return t===!0?!0:n==r?!1:e.next(n).then(o)})};return c["default"].first(e,n).then(u)})}},{key:"forEach",value:function(t,n,r){return e.every(t,function(e,t){return n(e,t),!0},r).then(function(){})}},{key:"reduce",value:function(t,n,r,u){return e.forEach(t,function(e,t){return r=n(r,e,t)},u).then(function(){return r})}},{key:"toArray",value:function(t,n){return e.reduce(t,function(e,t){return e.push(t),e},[],n)}},{key:"findKey",value:function(t,n,r){var u;return e.some(t,function(e,t){return Promise.resolve(n(e,t)).then(function(e){return e?!!(u=t)||!0:!1})},r).then(function(e){return e?u:null})}},{key:"find",value:function(t,n,r){return e.findKey(t,n,r).then(t.get)}},{key:"keyOf",value:function(t,n,r){return e.findKey(t,function(e){return e===n},r)}},{key:"indexOf",value:function(t,n,r){var u=-1;return e.some(t,function(e,t){return n==e?!!u++||!0:!1},r).then(function(e){if(e)return u;throw new Error})}},{key:"keyAt",value:function(t,n,r){return e.findKey(t,function(){return 0===n--})}},{key:"at",value:function(t,n,r){return e.keyAt(t,n,r).then(t.get)}},{key:"contains",value:function(t,n,r){return e.some(t,function(e){return e===n},r)}},{key:"reverse",value:function(e){function t(t){return e.next(t)}function n(t){return e.prev(t)}var r=e.get;return{get:r,prev:t,next:n}}},{key:"map",value:function(e,t){function n(n){return e.get(n).then(function(e){return t(e,n)})}var r=e.prev,u=e.next;return{get:n,prev:r,next:u}}},{key:"filter",value:function(t,n){function r(e){return t.get(e).then(function(e){if(n(e))return e;throw new Error})}function u(r){return e.findKey(e.reverse(t),n,[r,null])}function o(r){return e.findKey(t,n,[r,null])}return{get:r,prev:u,next:o}}},{key:"flatten",value:function(e){function t(t){var n=a.Path.fromKey(t);return a.Tree.get(e,n,1)}function n(t){var n=a.Path.fromKey(t);return a.Tree.prev(e,n,1).then(a.Path.toKey)}function r(t){var n=a.Path.fromKey(t);return a.Tree.next(e,n,1).then(a.Path.toKey)}return{get:t,prev:n,next:r}}},{key:"flatMap",value:function(t,n){return e.flatten(e.map(t,n))}},{key:"cache",value:function(e){return new f["default"](e)}},{key:"group",value:function(t,n){function r(r){return e.findKey(t,function(e,t){return n(e,t)===r}).then(function(){return i[r]=e.filter(t,function(e,t){return r===n(e,t)})})}function u(r){return e.findKey(e.reverse(t),function(e,t){var u=n(e,t);return u!==r&&!i[u]}).then(function(e){return null==e?null:t.get(e).then(function(t){return n(t,e)})})}function o(r){return e.findKey(t,function(e,t){var u=n(e,t);return u!==r&&!i[u]}).then(function(e){return null==e?null:t.get(e).then(function(t){return n(t,e)})})}var i=Object.create(null);return new f["default"]({get:r,prev:u,next:o})}},{key:"index",value:function(e){return new v["default"](e)}},{key:"zip",value:function(t,n,r){function u(e){return t.get(e).then(function(t){return n.get(e).then(function(e){return r(t,e)})})}function o(e){return t.prev(e).then(function(){return n.prev(e)})}function i(e){return t.next(e).then(function(){return n.next(e)})}return t=e.index(t),n=e.index(n),{get:u,prev:o,next:i}}},{key:"skip",value:function(t,n){return e.filter(e.index(t),function(e,t){return t>=n})}},{key:"take",value:function(t,n){return e.filter(e.index(t),function(e,t){return n>t})}},{key:"range",value:function(t,n,r){return e.filter(e.index(t),function(e,t){return t>=n&&r+n>t})}},{key:"scan",value:function(t,n,r){function u(e){return o.prev(e).then(function(e){return null==e?r:o.get(e)}).then(function(r){return t.get(e).then(function(e){return n(r,e)})})}var o,i=t.prev,c=t.next;return o=e.cache({get:u,prev:i,next:c})}}]),e}();n.List=h,n["default"]=h},{"./cache":4,"./index":5,"./range":14,"./tree":15}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;c=l=a=void 0,r=!1,null===u&&(u=Function.prototype);var c=Object.getOwnPropertyDescriptor(u,o);if(void 0!==c){if("value"in c)return c.value;var a=c.get;return void 0===a?void 0:a.call(i)}var l=Object.getPrototypeOf(u);if(null===l)return void 0;e=l,t=o,n=i,r=!0}},c=e("./observable_cache"),a=r(c),l=function(e){function t(e){var n=this;u(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.set=function(e,t){return n._list.set(e,t)},this.splice=function(e,t){for(var r=arguments.length,u=Array(r>2?r-2:0),o=2;r>o;o++)u[o-2]=arguments[o];var i;return(i=n._list).splice.apply(i,[e,t].concat(u))}}return o(t,e),t}(a["default"]);n.MutableCache=l,n["default"]=l},{"./observable_cache":11}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function e(e,t){var n=[],r=!0,u=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(a){u=!0,o=a}finally{try{!r&&c["return"]&&c["return"]()}finally{if(u)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;c=l=a=void 0,r=!1,null===u&&(u=Function.prototype);var c=Object.getOwnPropertyDescriptor(u,o);if(void 0!==c){if("value"in c)return c.value;var a=c.get;return void 0===a?void 0:a.call(i)}var l=Object.getPrototypeOf(u);if(null===l)return void 0;e=l,t=o,n=i,r=!0}},f=e("./observable_list"),s=e("./mutable_cache"),v=r(s),h=function(e){function t(e){var n=this;o(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.set=function(e,t){throw new Error("Not implemented")},this.splice=function(e,t){throw new Error("Not implemented")},this.addBefore=function(e,r){return t.addBefore(n,e,r)},this.addAfter=function(e,r){return t.addAfter(n,e,r)},this.push=function(e){return t.push(n,e)},this.unshift=function(e){return t.unshift(n,e)},this["delete"]=function(e){return t["delete"](n,e)},this.deleteBefore=function(e){return t.deleteBefore(n,e)},this.deleteAfter=function(e){return t.deleteAfter(n,e)},this.pop=function(){return t.pop(n)},this.shift=function(){return t.shift(n)},this.remove=function(e){return t.remove(n,e)},this.cache=function(){return t.create(t.cache(n))},this.map=function(e,r){return t.create(t.map(n,e,r))},null!=e&&(this.set=e.set,this.splice=e.splice)}return i(t,e),a(t,null,[{key:"isMutableList",value:function(e){return f.ObservableList.isObservableList(e)&&!!e.set&&!!e.splice}},{key:"create",value:function(e){return new t({get:e.get,prev:e.prev,next:e.next,observe:e.observe,set:e.set,splice:e.splice})}},{key:"addBefore",value:function(e,t,n){return e.prev(t).then(function(r){return e.splice(r,t,n)}).then(function(){return e.prev(t)})}},{key:"addAfter",value:function(e,t,n){return e.next(t).then(function(r){return e.splice(t,r,n)}).then(function(){return e.next(t)})}},{key:"push",value:function(e,n){return t.addBefore(e,null,n)}},{key:"unshift",value:function(e,n){return t.addAfter(e,null,n)}},{key:"delete",value:function(e,t){return e.get(t).then(function(n){return Promise.all([e.prev(t),e.next(t)]).then(function(t){var n=c(t,2),r=n[0],u=n[1];return e.splice(r,u)}).then(function(){return n})})}},{key:"deleteBefore",value:function(e,n){return e.prev(n).then(function(n){return t["delete"](e,n)})}},{key:"deleteAfter",value:function(e,n){return e.next(n).then(function(n){return t["delete"](e,n)})}},{key:"pop",value:function(e){return t.deleteBefore(e,null)}},{key:"shift",value:function(e){return t.deleteAfter(e,null)}},{key:"remove",value:function(e,n){return t.keyOf(e,n).then(function(n){t["delete"](e,n)})}},{key:"cache",value:function(e){return new v["default"](e)}},{key:"map",value:function(e,t,n){function r(t,r){return e.set(t,n(r,t))}function o(t,r){for(var o=arguments.length,i=Array(o>2?o-2:0),c=2;o>c;c++)i[c-2]=arguments[c];return e.splice.apply(e,[t,r].concat(u(i.map(n))))}var i=f.ObservableList.map(e,t),c=i.get,a=i.prev,l=i.next,s=i.observe;return{get:c,prev:a,next:l,observe:s,set:r,splice:o}}}]),t}(f.ObservableList);n.MutableList=h,n["default"]=h},{"./mutable_cache":8,"./observable_list":13}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./key"),i=r(o),c=function a(){var e=this;u(this,a),this.observe=function(t){var n=i["default"].create();return e._observers[n]=t,{unsubscribe:function(){delete e._observers[n]}}},this.notify=function(t){for(var n in e._observers)t(e._observers[n])},this._observers=Object.create(null)};n.Subject=c},{"./key":6}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,u=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(a){u=!0,o=a}finally{try{!r&&c["return"]&&c["return"]()}finally{if(u)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;c=l=a=void 0,r=!1,null===u&&(u=Function.prototype);var c=Object.getOwnPropertyDescriptor(u,o);if(void 0!==c){if("value"in c)return c.value;var a=c.get;return void 0===a?void 0:a.call(i)}var l=Object.getPrototypeOf(u);if(null===l)return void 0;e=l,t=o,n=i,r=!0}},a=e("./cache"),l=r(a),f=e("./observable_list"),s=function(e){function t(e){var n=this;u(this,t),c(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.observe=function(e){return n._subject.observe(e)},this.onInvalidate=function(e){if(!Array.isArray(e)){var t=n._prev[e],r=n._next[e];return null!=t&&(delete n._next[t],delete n._prev[e]),null!=r&&(delete n._prev[r],delete n._next[e]),n._subject.onInvalidate(e)}var u,o=i(e,2),t=o[0],r=o[1];for(u=t;void 0!==(u=n._next[u])&&(delete n._next[n._prev[u]],delete n._prev[u],u!=r);)delete n._byKey[u];for(u=r;void 0!==(u=n._prev[u])&&(delete n._prev[n._next[u]],delete n._next[u],u!=t);)delete n._byKey[u];n._subject.onInvalidate(e)},this._subject=new f.ListSubject,e.observe(this)}return o(t,e),t}(l["default"]);n.ObservableCache=s,n["default"]=s},{"./cache":4,"./observable_list":13}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;c=l=a=void 0,r=!1,null===u&&(u=Function.prototype);var c=Object.getOwnPropertyDescriptor(u,o);if(void 0!==c){if("value"in c)return c.value;var a=c.get;return void 0===a?void 0:a.call(i)}var l=Object.getPrototypeOf(u);if(null===l)return void 0;e=l,t=o,n=i,r=!0}},c=e("./index"),a=r(c),l=e("./observable_list"),f=function(e){function t(e){var n=this;u(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this._add=function(e,t){n._byIndex[t]=e,n._byKey[e]=t},this.observe=function(e){return n._subject.observe(e)},this.onInvalidate=function(e){for(var t,r=n._byIndex.length,t=Array.isArray(e)?n._byKey[e[0]]:n._byKey[e];t++<r;)delete n._byKey[n._byIndex[t]];n._byIndex.splice(t),n._subject.onInvalidate([0==t?null:t-1,null])},this._byKey=Object.create(null),this._subject=new l.ListSubject,e.observe(this)}return o(t,e),t}(a["default"]);n.ObservableIndex=f,n["default"]=f},{"./index":5,"./observable_list":13}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;c=l=a=void 0,r=!1,null===u&&(u=Function.prototype);var c=Object.getOwnPropertyDescriptor(u,o);if(void 0!==c){if("value"in c)return c.value;var a=c.get;return void 0===a?void 0:a.call(i)}var l=Object.getPrototypeOf(u);if(null===l)return void 0;e=l,t=o,n=i,r=!0}},a=e("./range"),l=r(a),f=e("./list"),s=e("./tree"),v=e("./observable"),h=e("./observable_cache"),p=r(h),d=e("./observable_index"),y=r(d),b=function(e){function t(){var e=this;u(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];c(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,r),this.onInvalidate=function(t){e.notify(function(e){e.onInvalidate(t)})}}return o(t,e),t}(v.Subject);n.ListSubject=b;var g=function(e){function t(e){var n=this;u(this,t),c(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.observe=function(e){throw new Error("Not implemented")},this.reverse=function(){return t.create(t.reverse(n))},this.map=function(e){return t.create(t.map(n,e))},this.filter=function(e){return t.create(t.filter(n,e))},this.flatten=function(){return t.create(t.flatten(n))},this.flatMap=function(e){return t.create(t.flatMap(n,e))},this.cache=function(){return t.create(t.cache(n))},this.index=function(){return t.create(t.index(n))},this.zip=function(e,r){return t.create(t.zip(n,e,r))},this.skip=function(e){return t.create(t.skip(n,e))},this.take=function(e){return t.create(t.take(n,e))},this.range=function(e,r){return t.create(t.range(n,e,r))},this.scan=function(e,r){return t.create(t.scan(n,e,r))},null!=e&&(this.observe=e.observe)}return o(t,e),i(t,null,[{key:"isObservableList",value:function(e){return f.List.isList(e)&&!!e.observe}},{key:"create",value:function(e){return new t({get:e.get,prev:e.prev,next:e.next,observe:e.observe})}},{key:"reverse",value:function(e){function t(t){return e.observe({onInvalidate:function(e){t.onInvalidate(e)}})}var n=f.List.reverse(e),r=n.get,u=n.prev,o=n.next;return{get:r,prev:u,next:o,observe:t}}},{key:"map",value:function(e,t){var n=f.List.map(e,t),r=n.get,u=n.prev,o=n.next;return{get:r,prev:u,next:o,observe:e.observe}}},{key:"filter",value:function(e,t){var n=f.List.filter(e,t),r=n.get,u=n.prev,o=n.next;return{get:r,prev:u,next:o,observe:e.observe}}},{key:"flatten",value:function(e){function t(e){var t=function(t){return Array.isArray(t)?void o.onInvalidate([s.Path.toKey(null!=t[0]?[e,t[0]]:[e]),s.Path.toKey(null!=t[1]?[e,t[1]]:[e])]):o.onInvalidate(s.Path.toKey([e,t]))};return{onInvalidate:t}}function n(n){return u.prev(n).then(function(n){var r=s.Path.fromKey(n),u=s.Path.head(r);return null==u||i[u]||e.get(u).then(function(e){return i[u]=e.observe(t(u))}),n})}function r(n){return u.next(n).then(function(n){var r=s.Path.fromKey(n),u=s.Path.head(r);return null==u||i[u]||e.get(u).then(function(e){return i[u]=e.observe(t(u))}),n})}var u=f.List.flatten(e),o=new b,i=Object.create(null),c=new p["default"]({get:e.get,prev:e.prev,next:e.next,observe:function(e){return null}});return e.observe({onInvalidate:function(e){f.List.forEach(c,function(e,t){i[t]&&(i[t].unsubscribe(),delete i[t])},e),o.onInvalidate(Array.isArray(e)?[s.Path.toKey([e[0]]),s.Path.toKey([e[1]])]:s.Path.toKey([e])),c.onInvalidate(e)}}),{get:u.get,prev:n,next:r,observe:o.observe}}},{key:"flatMap",value:function(e,n){return t.flatten(t.map(e,n))}},{key:"cache",value:function(e){return new p["default"](e)}},{key:"index",value:function(e){return new y["default"](e)}},{key:"zip",value:function(e,n,r){function u(t){return e.get(t).then(function(e){return n.get(t).then(function(t){return r(e,t)})})}function o(t){return e.prev(t).then(function(){return n.prev(t)})}function i(t){return e.next(t).then(function(){return n.next(t)})}e=t.index(e),n=t.index(n);var c=new b;return e.observe(c),n.observe(c),{get:u,prev:o,next:i,observe:c.observe}}},{key:"skip",value:function(e,n){return t.filter(t.index(e),function(e,t){return t>=n})}},{key:"take",value:function(e,n){return t.filter(t.index(e),function(e,t){return n>t})}},{key:"range",value:function(e,n,r){return t.filter(t.index(e),function(e,t){return t>=n&&r+n>t})}},{key:"scan",value:function(e,n,r){function u(t){return i.prev(t).then(function(e){return null==e?r:i.get(e)}).then(function(r){return e.get(t).then(function(e){return n(r,e)})})}function o(t){return e.observe({onInvalidate:function(n){l["default"].prev(e,n).then(function(e){return t.onInvalidate([e,null])})}})}var i,c=e.prev,a=e.next;return i=t.cache({get:u,prev:c,next:a,observe:o})}}]),t}(f.List);n.ObservableList=g,n["default"]=g},{"./list":7,"./observable":10,"./observable_cache":11,"./observable_index":12,"./range":14,"./tree":15}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;n.Range=r,function(e){function t(e){var t=arguments.length<=1||void 0===arguments[1]?[null,null]:arguments[1];return Array.isArray(t)?Promise.resolve(t[0]):e.prev(t)}function n(e){var t=arguments.length<=1||void 0===arguments[1]?[null,null]:arguments[1];return Array.isArray(t)?Promise.resolve(t[1]):e.next(t)}function r(e){var t=arguments.length<=1||void 0===arguments[1]?[null,null]:arguments[1];return Array.isArray(t)?e.next(t[0]):Promise.resolve(t)}function u(e){var t=arguments.length<=1||void 0===arguments[1]?[null,null]:arguments[1];return Array.isArray(t)?e.prev(t[1]):Promise.resolve(t)}e.prev=t,e.next=n,e.first=r,e.last=u}(r||(n.Range=r={})),n["default"]=r},{}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,u=e("./list");n.Path=r,function(e){function t(e){return JSON.stringify(e)}function n(e){return null==e?null:JSON.parse(e.toString())}function r(e){return null==e?null:JSON.stringify(e)}function u(e){return e?e[0]:null}function o(e,t){return e[t]}function i(e){return null==e?[]:e.slice(1,e.length)}function c(e,t){return[].concat(e).concat(t)}e.key=t,e.fromKey=n,e.toKey=r,e.head=u,e.get=o,e.tail=i,e.append=c}(r||(n.Path=r={}));var o;n.Tree=o,function(e){function t(t,n){var u=arguments.length<=2||void 0===arguments[2]?1/0:arguments[2],o=r.head(n),i=r.tail(n);return t.get(o).then(function(t){return 0==i.length||0==u?t:e.get(t,i,u)})}function n(t){var n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],o=arguments.length<=2||void 0===arguments[2]?1/0:arguments[2],i=r.head(n),c=r.tail(n);return(null==i||!c.length)&&o>0?t.prev(i).then(function(n){return null==n?null:t.get(n).then(function(t){return u.List.isList(t)?e.prev(t,null,o-1).then(function(e){return null==e?null:r.append(n,e)}):[n]})}):c.length&&o>0?t.get(i).then(function(t){return e.prev(t,c,o-1)}).then(function(n){return null!=n?r.append(i,n):t.prev(i).then(function(n){return null==n?null:t.get(n).then(function(t){return e.prev(t,null,o-1)}).then(function(e){return r.append(n,e)})})}):t.prev(i).then(function(e){return null!=e?[e]:null})}function o(t){var n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],o=arguments.length<=2||void 0===arguments[2]?1/0:arguments[2],i=r.head(n),c=r.tail(n);return(null==i||!c.length)&&o>0?t.next(i).then(function(n){return null==n?null:t.get(n).then(function(t){return u.List.isList(t)?e.next(t,null,o-1).then(function(e){return null==e?null:r.append(n,e)}):[n]})}):c.length&&o>0?t.get(i).then(function(t){return e.next(t,c,o-1)}).then(function(n){return null!=n?r.append(i,n):t.next(i).then(function(n){return null==n?null:t.get(n).then(function(t){return e.next(t,null,o-1)}).then(function(e){return r.append(n,e)})})}):t.next(i).then(function(e){return null!=e?[e]:null})}function i(e,n,r){var u=n.slice(0,n.length-1),o=n[n.length-1];return t(e,u).then(function(e){return e.set(o,r)})}function c(e,n,r){for(var u=arguments.length,o=Array(u>3?u-3:0),i=3;u>i;i++)o[i-3]=arguments[i];var c=n.slice(0,n.length-1),a=n[n.length-1],l=(r.slice(0,r.length-1),r[r.length-1]);return t(e,c).then(function(e){return e.splice.apply(e,[a,l].concat(o))})}e.get=t,e.prev=n,e.next=o,e.set=i,e.splice=c}(o||(n.Tree=o={})),n["default"]=o},{"./list":7}]},{},[2])(2)});